# 他己評価閲覧アプリ - セットアップガイド

このガイドに従って、他己評価閲覧アプリケーションをセットアップしてください。

## 前提条件

以下のソフトウェアがインストールされている必要があります：

- **Node.js** v16.0.0 以上
- **npm** v7.0.0 以上
- **Git**（オプション）

### Node.js のインストール確認

```bash
node --version
npm --version
```

## 1. プロジェクトのセットアップ

### 1.1 プロジェクトのクローン（またはダウンロード）

```bash
# Gitでクローンする場合
git clone <repository-url>
cd yak_result_app

# または、ZIPファイルをダウンロードして展開
```

### 1.2 依存関係のインストール

```bash
# ルートディレクトリで（バックエンド依存関係）
npm install

# フロントエンド依存関係
cd client
npm install
cd ..
```

## 2. 環境設定

### 2.1 環境変数ファイルの設定

`.env` ファイルを編集して、必要な環境変数を設定します：

```bash
# .env ファイルの内容
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-123456789
PORT=5000
NODE_ENV=development
COMPANY_DOMAIN=yourcompany.com
```

⚠️ **重要**: 
- `JWT_SECRET` は本番環境では必ず変更してください
- `COMPANY_DOMAIN` を実際の会社ドメインに変更してください

### 2.2 会社ドメインの設定

`COMPANY_DOMAIN` を実際の会社のメールドメインに変更してください。例：
- `COMPANY_DOMAIN=example.com` の場合、`user@example.com` 形式のみ登録可能

## 3. アプリケーションの起動

### 3.1 開発環境での起動

**ターミナル1（バックエンド）**:
```bash
# ルートディレクトリで
node server/index.js
```

**ターミナル2（フロントエンド）**:
```bash
# 別のターミナルで
cd client
npm start
```

### 3.2 起動確認

- バックエンド: http://localhost:5000
- フロントエンド: http://localhost:3000

正常に起動すると以下のメッセージが表示されます：

```
SQLiteデータベースに接続しました
データベーススキーマを初期化しました
データベースが正常に初期化されました
サーバーがポート 5000 で起動しました
開発環境: http://localhost:5000
```

## 4. 初期設定

### 4.1 管理者アカウントでログイン

初期管理者アカウント（パスワード: `password`）:
- **Email**: admin1@company.com
- **Email**: admin2@company.com
- **Email**: admin3@company.com
- **Password**: password

⚠️ **セキュリティ**: 本番環境では必ずパスワードを変更してください

### 4.2 会社ドメインの更新

管理者アカウントのメールアドレスも実際の会社ドメインに合わせて変更する必要があります：

1. データベースファイル `server/database/schema.sql` の84-86行目を編集
2. `@company.com` を実際のドメインに変更
3. データベースを再初期化（既存の `server/database/yak_result.db` を削除してサーバーを再起動）

## 5. データのインポート

### 5.1 Microsoft Forms データの準備

Microsoft Forms から出力されたExcelファイルを準備してください。ファイルには以下の列が含まれている必要があります：

- ID
- 開始時刻
- 完了時刻
- メール
- 名前
- 最終変更時刻
- 実施週：週を選択してください
- 氏名（バリュー実践対象者）
- 具体的な行動内容（バリュー実践）
- 氏名2（プリンシプル実践対象者）
- 具体的な行動内容（プリンシプル実践）
- 氏名：（貢献度対象者）
- 具体的な行動内容：（貢献度）
- 氏名3（バリュー定着貢献対象者）
- 具体的な行動内容3（バリュー定着貢献）

### 5.2 データインポート手順

1. http://localhost:3000 にアクセス
2. 管理者アカウントでログイン
3. 「管理者」メニューをクリック
4. 「データインポート」タブを選択
5. 「評価データ（Microsoft Forms Excel）」セクションでファイルを選択
6. 「評価データをインポート」ボタンをクリック
7. インポート結果を確認

### 5.3 参加者リストのインポート（オプション）

氏名表記統一のために参加者リストをインポートできます：

1. 「参加者リスト」セクションでExcelファイルを選択
2. ファイルには「正式氏名」列が含まれている必要があります
3. 「参加者リストをインポート」ボタンをクリック

## 6. 一般ユーザーの利用開始

### 6.1 ユーザー登録

1. http://localhost:3000/register にアクセス
2. 会社ドメインのメールアドレスで登録
3. 氏名とパスワードを入力
4. 「アカウント登録」をクリック

### 6.2 ログインと利用

1. 登録したメールアドレスとパスワードでログイン
2. ダッシュボードで概要を確認
3. 「他己評価閲覧」で詳細な評価を確認
4. 「評価設定」で自分が行った評価の設定を変更

## 7. トラブルシューティング

### 7.1 よくある問題

**問題**: "Cannot find module" エラー
```bash
# 解決方法: 依存関係を再インストール
rm -rf node_modules package-lock.json
npm install
cd client
rm -rf node_modules package-lock.json
npm install
```

**問題**: ポートが使用中
```bash
# 使用中のプロセスを確認
lsof -i :5000
lsof -i :3000

# プロセスを終了
kill -9 <PID>
```

**問題**: データベースエラー
```bash
# データベースファイルを削除して再初期化
rm server/database/yak_result.db
node server/index.js
```

### 7.2 ログの確認

- バックエンドログ: ターミナルに直接出力
- フロントエンドログ: ブラウザの開発者ツール（F12）のConsoleタブ
- ネットワークエラー: 開発者ツールのNetworkタブ

### 7.3 設定ファイルの確認

以下のファイルが正しく設定されているか確認してください：

- `.env` - 環境変数
- `client/package.json` - プロキシ設定（`"proxy": "http://localhost:5000"`）
- `server/database/schema.sql` - 管理者アカウントのドメイン

## 8. 本番環境デプロイ

### 8.1 本番用ビルド

```bash
# フロントエンドをビルド
cd client
npm run build
cd ..

# 環境変数を本番用に設定
NODE_ENV=production
```

### 8.2 セキュリティ設定

1. `.env` ファイルの `JWT_SECRET` を強固なものに変更
2. 管理者アカウントのパスワードを変更
3. `COMPANY_DOMAIN` を正しいドメインに設定
4. HTTPSの設定
5. ファイアウォールの設定

## 9. サポート

問題が解決しない場合は、以下の情報と共にサポートに連絡してください：

- エラーメッセージの全文
- Node.js、npmのバージョン
- オペレーティングシステム
- 実行したコマンドと手順
- ブラウザの開発者ツールのエラーログ